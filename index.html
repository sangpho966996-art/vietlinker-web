<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VietLinker - Káº¿t ná»‘i Cá»™ng Äá»“ng Viá»‡t táº¡i Hoa Ká»³</title>
  <meta name="description" content="VietLinker: Mua bÃ¡n, viá»‡c lÃ m, dá»‹ch vá»¥, Äƒn uá»‘ng, báº¥t Ä‘á»™ng sáº£n, rao váº·t cá»§a cá»™ng Ä‘á»“ng ngÆ°á»i Viá»‡t táº¡i Hoa Ká»³" />

  <!-- Styles (rÃºt gá»n, táº­p trung pháº§n tÃ¬m kiáº¿m + modal + tiá»‡n Ã­ch) -->
  <style>
    :root {
      --primary: #1e3c72;
      --accent: #dc143c;
      --gold: #FFD700;
      --text: #222;
      --muted: #666;
      --bg: #f6f7fb;
      --white: #fff;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(0,0,0,0.08);
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--text); background: var(--bg); }

    header { background: var(--white); position: sticky; top: 0; z-index: 30; box-shadow: var(--shadow); }
    .header-content {
      max-width: 1280px; margin: 0 auto; padding: 14px 20px;
      display: flex; align-items: center; justify-content: space-between; gap: 16px;
    }
    .logo { display: inline-flex; align-items: center; gap: 10px; text-decoration: none; color: var(--primary); font-weight: 800; font-size: 20px; }
    .user-actions { display: flex; align-items: center; gap: 10px; }
    .btn-post {
      background: linear-gradient(135deg, var(--accent) 0%, #b91c3c 100%); color: #fff; border: 0;
      padding: 10px 16px; border-radius: 999px; text-decoration: none; font-weight: 700; box-shadow: 0 6px 20px rgba(220,20,60,0.25);
    }
    .auth-buttons { display: flex; gap: 10px; }
    .btn-auth { text-decoration: none; font-weight: 700; border-radius: 999px; padding: 8px 14px; border: 2px solid var(--primary); color: var(--primary); background: #fff; }
    .btn-register { background: var(--primary); color: #fff; border-color: var(--primary); }

    nav { background: #ffffff; border-top: 1px solid #eee; }
    .nav-container { max-width: 1280px; margin: 0 auto; padding: 10px 20px; }
    .nav-links { display: flex; gap: 12px; overflow-x: auto; }
    .nav-links a { text-decoration: none; color: var(--text); padding: 8px 12px; border-radius: 10px; white-space: nowrap; }
    .nav-links a.active { background: #eef2ff; color: var(--primary); font-weight: 700; }

    /* Search section */
    .search { background: #fff; border-bottom: 1px solid #eee; }
    .search-inner { max-width: 1280px; margin: 0 auto; padding: 16px 20px; }
    .mega-search-box {
      display: flex; gap: 12px; align-items: stretch; flex-wrap: wrap; background: #f9fafb; padding: 12px; border-radius: 14px; border: 1px solid #eee;
    }
    .search-input-group {
      background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 10px 12px; display: flex; align-items: center; gap: 8px; min-height: 44px;
    }
    .search-input-group input, .search-input-group select {
      border: 0; outline: 0; font-size: 14px; min-width: 220px; background: transparent;
    }
    .search-btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, #2a5298 100%); color: white; border: 0; font-weight: 800;
      padding: 10px 20px; border-radius: 12px; display: inline-flex; align-items: center; gap: 8px; cursor: pointer;
    }
    .quick-searches { margin-top: 10px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .quick-search-tag { text-decoration: none; font-size: 13px; background: #fff; border: 1px solid #eee; padding: 6px 10px; border-radius: 999px; color: var(--text); }

    /* Modal */
    .search-results-modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.45); display: none; z-index: 50; padding: 20px;
    }
    .search-results-content {
      background: #fff; max-width: 900px; margin: 0 auto; border-radius: 16px; overflow: hidden; box-shadow: var(--shadow);
      display: grid; grid-template-rows: auto 1fr; height: calc(100vh - 40px);
    }
    .search-results-header {
      display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid #eee;
      position: sticky; top: 0; background: #fff; z-index: 1;
    }
    .close-search-modal { background: transparent; border: 0; font-size: 28px; line-height: 1; cursor: pointer; color: var(--muted); }
    .search-results-body { overflow: auto; padding: 16px; }

    /* Helpers */
    .hidden { display: none !important; }
    .user-info { display: none; align-items: center; gap: 8px; position: relative; }
    .user-info.active { display: inline-flex; }
    .user-avatar { width: 36px; height: 36px; border-radius: 50%; background: #eef2ff; color: var(--primary); display: grid; place-items: center; font-weight: 800; }
    .user-menu { display: none; }
    .user-menu.active { display: inline-flex; gap: 10px; }
    .nav-divider { width: 1px; height: 20px; background: #eee; }

    /* Simple sections to keep page complete */
    .section { padding: 40px 20px; max-width: 1280px; margin: 0 auto; }
    .hero { background: linear-gradient(135deg, #f8fafc 0%, #fff 100%); }
    .section h2 { margin: 0 0 6px; color: var(--primary); }
    .muted { color: var(--muted); }
    footer { margin-top: 40px; background: var(--primary); color: #fff; }
    .footer-inner { max-width: 1280px; margin: 0 auto; padding: 24px 20px; display: grid; gap: 8px; }
    .floating-post-btn {
      position: fixed; right: 20px; bottom: 20px; width: 58px; height: 58px; border-radius: 50%;
      background: linear-gradient(135deg, var(--accent) 0%, #b91c3c 100%); color: #fff; display: grid; place-items: center; text-decoration: none;
      font-size: 22px; box-shadow: 0 10px 30px rgba(220,20,60,0.35); z-index: 40;
    }
    @media (max-width: 768px) {
      .search-input-group input, .search-input-group select { min-width: 0; width: 100%; }
      .search-btn-primary { width: 100%; justify-content: center; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-content">
      <a class="logo" href="index.html" aria-label="VietLinker">
        <svg width="26" height="26" viewBox="0 0 100 100" aria-hidden="true">
          <circle cx="50" cy="50" r="45" fill="#1e3c72" opacity="0.1"/>
          <circle cx="50" cy="25" r="8" fill="#dc143c"/>
          <circle cx="25" cy="50" r="8" fill="#FFD700"/>
        </svg>
        <span>VietLinker</span>
      </a>

      <div class="user-actions">
        <a href="post-form.html" class="btn-post">âœï¸ ÄÄƒng tin</a>

        <div class="user-info" id="userInfo">
          <div class="user-avatar" id="userAvatar">U</div>
          <span class="user-name" id="userName">User</span>
        </div>

        <div class="auth-buttons" id="authButtons">
          <a href="login.html" class="btn-auth btn-login">ÄÄƒng Nháº­p</a>
          <a href="register.html" class="btn-auth btn-register">ÄÄƒng KÃ½ Ngay</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Nav -->
  <nav>
    <div class="nav-container">
      <div class="nav-links">
        <a href="index.html" class="active">ğŸ  Trang Chá»§</a>

        <div class="user-menu" id="userMenu">
          <div class="nav-divider"></div>
          <a href="profile.html">ğŸ‘¤ Há»“ SÆ¡</a>
          <a href="my-posts.html">ğŸ“ Tin ÄÄƒng</a>
          <div class="nav-divider"></div>
        </div>

        <a href="marketplace.html">ğŸ›’ Mua BÃ¡n</a>
        <a href="jobs.html">ğŸ’¼ Viá»‡c LÃ m</a>
        <a href="services.html">ğŸ¤ Dá»‹ch Vá»¥</a>
        <a href="food.html">ğŸœ Ä‚n Uá»‘ng</a>
        <a href="realestate.html">ğŸ  BÄS & Tiá»‡m</a>
        <a href="classifieds.html">ğŸ“‹ Rao Váº·t</a>
        <a href="promotions.html">ğŸ Khuyáº¿n MÃ£i</a>
      </div>
    </div>
  </nav>

  <!-- Search -->
  <section class="search" aria-label="TÃ¬m kiáº¿m">
    <div class="search-inner">
      <div class="mega-search-box">
        <div class="search-input-group">
          <span class="input-icon" aria-hidden="true">ğŸ”</span>
          <input type="text" id="searchKeyword" placeholder="Tá»« khÃ³a (vÃ­ dá»¥: nail, phá»Ÿ, Honda)" aria-label="Tá»« khÃ³a">
        </div>

        <div class="search-input-group location-group">
          <span class="input-icon" aria-hidden="true">ğŸ“</span>
          <input type="text" id="searchLocation" placeholder="Zipcode hoáº·c ThÃ nh phá»‘" aria-label="Khu vá»±c">
        </div>

        <div class="search-input-group">
          <span class="input-icon" aria-hidden="true">ğŸ“‚</span>
          <select id="searchCategory" aria-label="Danh má»¥c">
            <option value="">Táº¥t cáº£ danh má»¥c</option>
            <option value="jobs">ğŸ’¼ Viá»‡c lÃ m</option>
            <option value="marketplace">ğŸ›’ Mua bÃ¡n</option>
            <option value="services">ğŸ¤ Dá»‹ch vá»¥</option>
            <option value="food_dining">ğŸœ Ä‚n uá»‘ng</option>
            <option value="real_estate">ğŸ  Báº¥t Ä‘á»™ng sáº£n</option>
            <option value="classifieds">ğŸ“‹ Rao váº·t</option>
            <option value="promotions">ğŸ Khuyáº¿n mÃ£i</option>
          </select>
        </div>

        <button class="search-btn-primary" id="searchButton" type="button">
          <span>ğŸ”</span><span>TÃŒM KIáº¾M</span>
        </button>
      </div>

      <div class="quick-searches">
        <span>TÃ¬m nhanh:</span>
        <a href="#" class="quick-search-tag" data-search="Thá»£ Nail">Thá»£ Nail</a>
        <a href="#" class="quick-search-tag" data-search="PhÃ²ng cho thuÃª">PhÃ²ng cho thuÃª</a>
        <a href="#" class="quick-search-tag" data-search="Honda Civic">Honda Civic</a>
        <a href="#" class="quick-search-tag" data-search="Phá»Ÿ">Phá»Ÿ</a>
        <a href="#" class="quick-search-tag" data-search="Tiá»‡m nail">Tiá»‡m nail</a>
      </div>
    </div>
  </section>

  <!-- Search Results Modal -->
  <div id="searchResultsModal" class="search-results-modal" role="dialog" aria-modal="true" aria-labelledby="searchResultsTitle">
    <div class="search-results-content">
      <div class="search-results-header">
        <h3 id="searchResultsTitle" style="margin:0;color:var(--primary);">Káº¿t quáº£ tÃ¬m kiáº¿m</h3>
        <button class="close-search-modal" id="closeModalBtn" aria-label="ÄÃ³ng">&times;</button>
      </div>
      <div class="search-results-body" id="searchResultsBody"></div>
    </div>
  </div>

  <!-- Simple sections to keep page complete -->
  <section class="section hero">
    <h2>Káº¿t Ná»‘i Cá»™ng Äá»“ng Viá»‡t táº¡i Hoa Ká»³</h2>
    <p class="muted">Tá»« mua bÃ¡n, viá»‡c lÃ m, dá»‹ch vá»¥, áº©m thá»±c Ä‘áº¿n báº¥t Ä‘á»™ng sáº£n - Táº¥t cáº£ trong má»™t!</p>
  </section>

  <section class="section">
    <h2>Danh má»¥c ná»•i báº­t</h2>
    <p class="muted">Viá»‡c LÃ m, Dá»‹ch Vá»¥, Ä‚n Uá»‘ng, BÄS & Tiá»‡m, Rao Váº·t, Khuyáº¿n MÃ£i</p>
  </section>

  <section class="section">
    <h2>Táº¡i sao chá»n VietLinker?</h2>
    <p class="muted">An toÃ n, miá»…n phÃ­, dá»… dÃ¹ng, cáº­p nháº­t liÃªn tá»¥c, cá»™ng Ä‘á»“ng lá»›n máº¡nh.</p>
  </section>

  <section class="section" style="text-align:center;">
    <h2>Sáºµn sÃ ng káº¿t ná»‘i?</h2>
    <p class="muted">Tham gia cá»™ng Ä‘á»“ng VietLinker ngay hÃ´m nay vÃ  khÃ¡m phÃ¡ cÆ¡ há»™i</p>
    <div style="display:inline-flex; gap:10px; flex-wrap:wrap; justify-content:center;">
      <a href="register.html" class="btn-post" style="box-shadow:none;">âœ¨ ÄÄƒng KÃ½ Miá»…n PhÃ­</a>
      <a href="marketplace.html" class="btn-auth btn-login" style="border-color:var(--primary);">ğŸ” Xem Tin ÄÄƒng</a>
    </div>
  </section>

  <footer>
    <div class="footer-inner">
      <div>&copy; 2024 VietLinker. Táº¥t cáº£ quyá»n Ä‘Æ°á»£c báº£o lÆ°u. Made with â¤ï¸ for Vietnamese Community</div>
    </div>
  </footer>

  <!-- Floating Post Button -->
  <a href="post-form.html" class="floating-post-btn" title="ÄÄƒng tin">âœï¸</a>

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
  <script>
    // Cáº¥u hÃ¬nh Supabase (THAY báº±ng thÃ´ng tin cá»§a báº¡n)
    const SUPABASE_URL = 'https://YOUR_PROJECT_ID.supabase.co';
    const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';

    const supabase = (window.supabase && SUPABASE_URL && SUPABASE_ANON_KEY)
      ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
      : null;

    // Helpers
    function getEl(id) { return document.getElementById(id); }
    function openModal() { const m = getEl('searchResultsModal'); if (m) m.style.display = 'block'; }
    function closeModal() { const m = getEl('searchResultsModal'); if (m) m.style.display = 'none'; }
    getEl('closeModalBtn')?.addEventListener('click', closeModal);
    window.addEventListener('click', (e) => { const m = getEl('searchResultsModal'); if (e.target === m) closeModal(); });

    // Safe element factory
    function el(tag, props = {}, ...children) {
      const node = document.createElement(tag);
      Object.entries(props).forEach(([k, v]) => {
        if (k === 'class') node.className = v;
        else if (k === 'text') node.textContent = v ?? '';
        else if (k.startsWith('aria-')) node.setAttribute(k, v);
        else if (v !== undefined && v !== null) node.setAttribute(k, v);
      });
      children.forEach(child => {
        if (child == null) return;
        if (child instanceof Node) node.appendChild(child);
        else node.appendChild(document.createTextNode(String(child)));
      });
      return node;
    }

    // Render results safely
    function renderResults(groups) {
      const body = getEl('searchResultsBody');
      if (!body) return;
      body.innerHTML = '';

      if (!groups || groups.length === 0) {
        body.appendChild(el('div', { style: 'text-align:center;padding:40px;' }, 'ğŸ˜” KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£ nÃ o.'));
        return;
      }

      const nameMap = {
        jobs: 'ğŸ’¼ Viá»‡c LÃ m',
        marketplace: 'ğŸ›’ Mua BÃ¡n',
        services: 'ğŸ¤ Dá»‹ch Vá»¥',
        food_dining: 'ğŸœ Ä‚n Uá»‘ng',
        real_estate: 'ğŸ  Báº¥t Äá»™ng Sáº£n',
        classifieds: 'ğŸ“‹ Rao Váº·t',
        promotions: 'ğŸ Khuyáº¿n MÃ£i'
      };

      const wrap = el('div');
      groups.forEach(group => {
        const title = el('h4', { style: 'margin:10px 0;color:var(--primary);' }, `${nameMap[group.table] || group.table} (${group.data.length})`);
        wrap.appendChild(title);

        group.data.forEach(item => {
          const card = el('div', { style: 'background:#f8f9fa;padding:12px;border-radius:12px;margin:8px 0;border:1px solid #eee;' });
          const h = el('div', { style: 'font-weight:700;color:#1e3c72;' }, item.title || item.name || '(KhÃ´ng tiÃªu Ä‘á»)');
          const meta = el('div', { style: 'display:flex;gap:12px;color:#888;font-size:13px;margin:4px 0;' });
          if (item.city) meta.appendChild(el('span', { text: `ğŸ“ ${item.city}` }));
          if (item.zipcode) meta.appendChild(el('span', { text: `ğŸ·ï¸ ${item.zipcode}` }));
          if (item.price || item.price_range) meta.appendChild(el('span', { text: `ğŸ’° ${item.price || item.price_range}` }));
          const descText = (item.description || '').toString();
          const desc = el('div', { style: 'color:#444;font-size:14px;' }, descText.length > 160 ? descText.slice(0, 160) + 'â€¦' : descText);

          card.append(h, meta, desc);
          wrap.appendChild(card);
        });
      });

      body.appendChild(wrap);
    }

    async function performGlobalSearch() {
      const kwEl = getEl('searchKeyword');
      const lcEl = getEl('searchLocation');
      const catEl = getEl('searchCategory');

      const keyword = kwEl?.value?.trim() || '';
      const location = lcEl?.value?.trim() || '';
      const category = catEl?.value || '';

      if (!keyword && !location && !category) {
        alert('Vui lÃ²ng nháº­p thÃ´ng tin tÃ¬m kiáº¿m!');
        return;
      }

      openModal();
      const body = getEl('searchResultsBody');
      if (body) body.innerHTML = '<div style="text-align:center;padding:40px;">ğŸ” Äang tÃ¬m kiáº¿m...</div>';
      if (!supabase) {
        // No Supabase: mock result
        const mock = [{ table: category || 'marketplace', data: [{ title: 'Káº¿t quáº£ máº«u', city: 'San Jose, CA', price: '$100', description: 'VÃ­ dá»¥ minh hoáº¡ khi chÆ°a cáº¥u hÃ¬nh Supabase.' }] }];
        renderResults(mock);
        return;
      }

      const allTables = ['jobs', 'marketplace', 'services', 'food_dining', 'real_estate', 'classifieds', 'promotions'];
      const tables = category ? [category] : allTables;

      const groups = [];
      await Promise.all(tables.map(async (table) => {
        let q = supabase.from(table).select('title,name,description,city,zipcode,price,price_range').limit(10);

        if (keyword) {
          // TÃ¬m trong title + description
          q = q.or(`title.ilike.%${keyword}%,description.ilike.%${keyword}%`);
        }
        if (location) {
          if (/^\d{5}$/.test(location)) {
            q = q.eq('zipcode', location);
          } else {
            q = q.ilike('city', `%${location}%`);
          }
        }

        const { data, error } = await q;
        if (!error && data && data.length) groups.push({ table, data });
      }));

      if (groups.length === 0) {
        renderResults([]);
      } else {
        renderResults(groups);
      }
    }

    async function checkAuth() {
      if (!supabase) return;
      const { data } = await supabase.auth.getUser();
      const user = data?.user;
      const userInfo = getEl('userInfo');
      const authButtons = getEl('authButtons');
      const userMenu = getEl('userMenu');

      if (user) {
        userInfo?.classList.add('active');
        authButtons?.classList.add('hidden');
        userMenu?.classList.add('active');

        // VÃ­ dá»¥ láº¥y tÃªn hiá»ƒn thá»‹
        let displayName = user.email;
        // Náº¿u cÃ³ báº£ng users, cÃ³ thá»ƒ load thÃªm tÃªn
        try {
          const { data: u } = await supabase.from('users').select('full_name,name').eq('email', user.email).single();
          if (u) displayName = u.full_name || u.name || displayName;
        } catch {}
        const nameEl = getEl('userName'); if (nameEl) nameEl.textContent = displayName;
        const avaEl = getEl('userAvatar'); if (avaEl) avaEl.textContent = (displayName || 'U').charAt(0).toUpperCase();
      } else {
        userInfo?.classList.remove('active');
        authButtons?.classList.remove('hidden');
        userMenu?.classList.remove('active');
      }
    }

    async function signOut() {
      if (!supabase) return;
      if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n Ä‘Äƒng xuáº¥t?')) return;
      await supabase.auth.signOut();
      location.reload();
    }

    function getUserLocation() {
      if (!('geolocation' in navigator)) return;
      // Geolocation yÃªu cáº§u HTTPS (trá»« localhost)
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          console.log('Location:', pos.coords.latitude, pos.coords.longitude);
        },
        (err) => {
          console.log('Geolocation error:', err?.message);
        },
        { enableHighAccuracy: false, timeout: 5000 }
      );
    }

    // Wire up events
    window.addEventListener('load', () => {
      console.log('âœ… VietLinker Ready');
      getEl('searchButton')?.addEventListener('click', performGlobalSearch);
      getEl('searchKeyword')?.addEventListener('keypress', (e) => { if (e.key === 'Enter') performGlobalSearch(); });
      getEl('searchLocation')?.addEventListener('keypress', (e) => { if (e.key === 'Enter') performGlobalSearch(); });
      document.querySelectorAll('.quick-search-tag').forEach(a => {
        a.addEventListener('click', (e) => {
          e.preventDefault();
          const kw = a.getAttribute('data-search') || '';
          const elKw = getEl('searchKeyword'); if (elKw) elKw.value = kw;
          performGlobalSearch();
        });
      });

      // init auth & location
      checkAuth();
      getUserLocation();
    });

    // Expose signOut (náº¿u Ä‘Æ°á»£c dÃ¹ng bá»Ÿi menu)
    window.signOut = signOut;
  </script>
</body>
</html>
